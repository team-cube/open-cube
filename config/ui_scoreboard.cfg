///////////////////////////////////////////////////////////////////////////////
//  Scoreboard                                                               //
///////////////////////////////////////////////////////////////////////////////

newui "scoreboard" [
   if $mainmenu [hideui "scoreboard"]
   uiallowinput 0
   //uiabovehud 1 // Can we have the scoreboard be on top of Console & Chat text?
   refreshscoreboard
   uicolor $c_menu_a 0 0 [
      uioutline $c_line_a ; uiclamp- 1 1 1 1
      uivlist 0 [
         if (> $getmode 2) [
            UI_headerteam
            uifill 0 0.005
            UI_subheaderteam
            uifill 0 0.005
            UI_playerlistteam
         ] [
            UI_headersolo
            uifill 0 0.005
            UI_subheadersolo
            uifill 0 0.005
            UI_playerlistsolo
         ]
         uifill 0 0.005
         UI_spectatorlist
      ]
   ]
] [if $mainmenu [hideui "scoreboard"]] []

///////////////////////////////////////////////////////////////////////////////

UI_headersolo = [
   uifill 0 0.005
   uifill $blarg_soloboardsize $blarg_headerheight [
      uifill (? (= $showip 1) $blarg_headersizeA $blarg_soloboardsize) 0 [
         uialign -1
         uiclip (? (= $showip 1) $blarg_headersizeA $blarg_soloboardsize) 0 [
            uialign -1
            uispace 0.01 0 [
               uivlist 0 [
                  if $scoreboardservinfo [
                     uitext $scoreboardservinfo 0.65
                  ] [
                     uitext "^f4Tesseract" 0.65
                  ]
                  uihlist 0.015 [
                     uifill
                     uihlist 0.003 [
                        uitext "^fs[" $blarg_headerfontsize2
                        uitext (format "%2%1" (getmastermodename $getmastermode) (at ["^f0" "^f0" "^f2" "^f3"] $getmastermode)) $blarg_headerfontsize2
                        uitext "^fS]" $blarg_headerfontsize2
                     ]
                     UItriangle 0x606060 0.01 0.01 270
                     uitext (getmodeprettyname $getmode) $blarg_headerfontsize2
                     UItriangle 0x606060 0.01 0.01 270
                     uitext $scoreboardmap $blarg_headerfontsize2
                     if (m_timed $getmode) [
                        UItriangle 0x606060 0.01 0.01 270
                        uitext (concatword (? (|| $intermission $paused) "^f3" "^f8") $scoreboardtime) $blarg_headerfontsize2
                     ]
                  ]
                  uialign* -1
               ]
            ]
         ]
      ]
      UI_showip
   ]
]
UI_headerteam = [
   uifill 0 0.005
   uifill $blarg_teamboardsize $blarg_headerheight [
      uifill (? (= $showip 1) $blarg_teamheadersizeA $blarg_teamboardsize) 0 [
         uialign -1
         uiclip (? (= $showip 1) $blarg_teamheadersizeA $blarg_teamboardsize) 0 [
            uialign -1
            uispace 0.01 0 [
               uivlist 0 [
                  if $scoreboardservinfo [
                     uitext $scoreboardservinfo $blarg_headerfontsize1
                  ] [uitext "^f4Tesseract" $blarg_headerfontsize1]
                  uihlist 0.015 [
                     uifill
                     uihlist 0.003 [
                        uitext "^fs[" $blarg_headerfontsize2
                        uitext (format "%2%1" (getmastermodename $getmastermode) (at ["^f0" "^f0" "^f2" "^f3"] $getmastermode)) $blarg_headerfontsize2
                        uitext "^fS]" $blarg_headerfontsize2
                     ]
                     UItriangle 0x606060 0.01 0.01 270
                     uitext (getmodeprettyname $getmode) $blarg_headerfontsize2
                     UItriangle 0x606060 0.01 0.01 270
                     uitext $scoreboardmap $blarg_headerfontsize2
                     if (m_timed $getmode) [
                        UItriangle 0x606060 0.01 0.01 270
                        uitext (concatword (? (|| $intermission $paused) "^f3" "^f8") $scoreboardtime) $blarg_headerfontsize2
                     ]
                  ]
                  uialign* -1
               ]
            ]
         ]
      ]
      UI_showip
   ]
]
UI_showip  = [
   if $showip [
      uifill $blarg_headersizeB 0 [
         uialign 1
         UIbar 0 1; uialign- -1
         uiclip 0.18 0 [
            uialign 1
            uispace 0.01 0 [
               uivlist 0.004 [
                  uicolortext $servinfoname 0x808080 $blarg_headerfontsize3
                  uicolortext $servinfoport 0x808080 $blarg_headerfontsize3
                  uialign* 1
               ]
            ]
            uialign- 1
         ]
      ]
   ]
]

//-----------------------------------------------------------------------------

UI_subheadersolo = [
   uicolor 0x99161616 $blarg_soloboardsize 0.022 [
      uihlist 0 [
         uialign 1 1
         if $showkills  [uifill 0.080 0 [uicolortext "K"    0x808080 0.45 ; uialign- 1]]
         if $showdeaths [uifill 0.060 0 [uicolortext "D"    0x808080 0.45 ; uialign- 1]]
         if $scoreboardmultiplayer [
            if $showpj        [uifill 0.060 0 [uicolortext "PJ"   0x808080 0.45 ; uialign- 1]]
            if $showping      [uifill 0.060 0 [uicolortext "PING" 0x808080 0.45 ; uialign- 1]]
            if $showclientnum [uifill 0.046 0 [uicolortext "#"    0x808080 0.45 ; uialign- 1]]
         ]
         uifill 0.018
      ]
   ]
]
UI_subheaderteam = [
   uihlist 0 [
      uicolor 0x99202860 (*f $blarg_teamboardsize 0.5) 0.042 [ // << blue
         uihlist 0 [
            uialign -1 1
            uifill 0.018
            if $scoreboardmultiplayer [
               if $showclientnum [uifill 0.046 0 [uicolortext "#"    0x808080 0.45 ; uialign- -1]]
               if $showping      [uifill 0.060 0 [uicolortext "PING" 0x808080 0.45 ; uialign- -1]]
               if $showpj        [uifill 0.060 0 [uicolortext "PJ"   0x808080 0.45 ; uialign- -1]]
            ]
            if $showdeaths [uifill 0.060 0 [uicolortext "D"    0x808080 0.45 ; uialign- -1]]
            if $showkills  [uifill 0.080 0 [uicolortext "K"    0x808080 0.45 ; uialign- -1]]
         ]
         uispace 0.01 0 [
            uialign 1
            uicolortext "99" 0x4060D0 1
         ]
      ]
      uicolor 0x99602020 (*f $blarg_teamboardsize 0.5) 0.042 [ // >> red
         uispace 0.01 0 [
            uialign -1
            uicolortext "99" 0xD04040 1
         ]
         uihlist 0 [
            uialign 1 1
            if $showkills  [uifill 0.080 0 [uicolortext "K"    0x808080 0.45 ; uialign- 1]]
            if $showdeaths [uifill 0.060 0 [uicolortext "D"    0x808080 0.45 ; uialign- 1]]
            if $scoreboardmultiplayer [
               if $showpj        [uifill 0.060 0 [uicolortext "PJ"   0x808080 0.45 ; uialign- 1]]
               if $showping      [uifill 0.060 0 [uicolortext "PING" 0x808080 0.45 ; uialign- 1]]
               if $showclientnum [uifill 0.046 0 [uicolortext "#"    0x808080 0.45 ; uialign- 1]]
            ]
            uifill 0.018
         ]
      ]
   ]
]

//-----------------------------------------------------------------------------

UI_playerlistsolo = [
   uivlist 0 [
      loopscoreboard cn 0 [
         uicolor $blarg_solo2 $blarg_tablewidth $blarg_tablerowheight [
            pushif highlight (scoreboardhighlight $cn) [
               uifill (-f $blarg_tablewidth 0.002) (-f $blarg_tablerowheight 0.002) [uioutline 0xA0A0A0 ; uiclamp- 1 1 1 1] // outline fix/hack
            ]
            uihlist 0 [
               uialign -1
               uifill 0.01
               uicolortext (getclientcolorname $cn) (scoreboardstatus $cn) 0.6
            ]
            uihlist 0 [
               uialign 1
               if $showkills  [uifill 0.080 0 [uicolortext (getclientfrags $cn) 0x808080 $blarg_tablefontsize ; uialign- 1]] // <-- uiclip THESE
               if $showdeaths [uifill 0.060 0 [uicolortext (getclientfrags $cn) 0x808080 $blarg_tablefontsize ; uialign- 1]]
               if $scoreboardmultiplayer [
                  if $showpj        [uifill 0.060 0 [uicolortext (scoreboardpj $cn)   0x808080 $blarg_tablefontsize ; uialign- 1]]
                  if $showping      [uifill 0.060 0 [uicolortext (scoreboardping $cn) 0x808080 $blarg_tablefontsize ; uialign- 1]]
                  if $showclientnum [uifill 0.046 0 [uicolortext $cn                  0x808080 $blarg_tablefontsize ; uialign- 1]]
               ]
               uifill 0.009
            ]
         ]
      ]
   ]
]

UI_playerlistteam = [
   uihlist 0 [
      uivlist 0 [ // << blue
         uialign 0 -1
         loopscoreboard cn 1 [
            uicolor $blarg_azul1 $blarg_tablewidthteam $blarg_tablerowheight [
               pushif highlight (scoreboardhighlight $cn) [
                  uifill (-f $blarg_tablewidth 0.002) (-f $blarg_tablerowheight 0.002) [uioutline 0xA0A0A0 ; uiclamp- 1 1 1 1] // outline fix/hack
               ]
               uihlist 0 [
                  uialign 1
                  uicolortext (getclientcolorname $cn) (scoreboardstatus $cn) 0.6
                  uifill 0.01
               ]
               uihlist 0 [
                  uialign -1
                  uifill 0.009
                  if $scoreboardmultiplayer [
                     if $showclientnum [uifill 0.046 0 [uicolortext $cn                  0x808080 $blarg_tablefontsize ; uialign- -1]]
                     if $showping      [uifill 0.060 0 [uicolortext (scoreboardping $cn) 0x808080 $blarg_tablefontsize ; uialign- -1]]
                     if $showpj        [uifill 0.060 0 [uicolortext (scoreboardpj $cn)   0x808080 $blarg_tablefontsize ; uialign- -1]]
                  ]
                  if $showdeaths [uifill 0.060 0 [uicolortext (getclientfrags $cn) 0x808080 $blarg_tablefontsize ; uialign- -1]]
                  if $showkills  [uifill 0.080 0 [uicolortext (getclientfrags $cn) 0x808080 $blarg_tablefontsize ; uialign- -1]]
               ]
            ]
         ]
         uialign* 0 -1
      ]
      uifill 0.02 //********************************************************
      uivlist 0 [ // >> red
         uialign 0 -1
         loopscoreboard cn 2 [
            uicolor $blarg_rojo1 $blarg_tablewidthteam $blarg_tablerowheight [
               pushif highlight (scoreboardhighlight $cn) [
                  uifill (-f $blarg_tablewidth 0.002) (-f $blarg_tablerowheight 0.002) [uioutline 0xA0A0A0 ; uiclamp- 1 1 1 1] // outline fix/hack
               ]
               uihlist 0 [
                  uialign -1
                  uifill 0.01
                  uicolortext (getclientcolorname $cn) (scoreboardstatus $cn) 0.6
               ]
               uihlist 0 [
                  uialign 1
                  if $showkills  [uifill 0.080 0 [uicolortext (getclientfrags $cn) 0x808080 $blarg_tablefontsize ; uialign- 1]] // <-- uiclip THESE
                  if $showdeaths [uifill 0.060 0 [uicolortext (getclientfrags $cn) 0x808080 $blarg_tablefontsize ; uialign- 1]]
                  if $scoreboardmultiplayer [
                     if $showpj        [uifill 0.060 0 [uicolortext (scoreboardpj $cn)   0x808080 $blarg_tablefontsize ; uialign- 1]]
                     if $showping      [uifill 0.060 0 [uicolortext (scoreboardping $cn) 0x808080 $blarg_tablefontsize ; uialign- 1]]
                     if $showclientnum [uifill 0.046 0 [uicolortext $cn                  0x808080 $blarg_tablefontsize ; uialign- 1]]
                  ]
                  uifill 0.009
               ]
            ]
         ]
         uialign* 0 -1
      ]
   ]
]

//-----------------------------------------------------------------------------

UI_spectatorlist = [
   if $showspectators [
      uicolor 0x99161616 0 0.03 [
         uiclamp 1 1 1 1
         uigrid 2 0.04 0 [ // <---------- ????? Wrapping uihlist ?????
            loopscoreboard cn -1 [
               uifill 0 0 [
                  pushif sbhigh (scoreboardhighlight $cn) [
                     uioutline 0xA0A0A0 ; uiclamp- 1 1 1 1
                  ]
                  uihlist 0.01 [
                     uicolortext (getclientcolorname $cn) (scoreboardstatus $cn) 0.52
                     if $showclientnum [uitext $cn 0.52]
                  ]
               ]
            ]
         ]
      ]
   ]
]


///////////////////////////////////////////////////////////CRAP

blarg_soloboardsize = 0.75
blarg_teamboardsize = 1.12

blarg_headerheight = 0.05
blarg_headersizeA  = (-f $blarg_soloboardsize 0.18)
blarg_headersizeB  = 0.18

blarg_teamheadersizeA = (-f $blarg_teamboardsize 0.18)
blarg_teamheadersizeB = 0.18

blarg_headerfontsize1 = 0.65
blarg_headerfontsize2 = 0.52
blarg_headerfontsize3 = 0.52

blarg_tablefontsize  = 0.52
blarg_tablerowheight = 0.024
blarg_tablewidth     = (-f $blarg_soloboardsize 0.02)
blarg_tablewidthteam = (-f (*f $blarg_teamboardsize 0.5) 0.02)

blarg_rojo1 = 0x993B3535
blarg_rojo2 = 0x99332E2E

blarg_azul1 = 0x9935383B
blarg_azul2 = 0x992E3033

blarg_solo1 = 0x992F2F2F
blarg_solo2 = 0x99292929

///////////////////////////////////////////////////////////CRAP
